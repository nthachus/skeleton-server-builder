version: "3"
services:
  builder:
    build: .
    image: "debian-skeleton:slim"
    container_name: skeleton-builder
    volumes:
      - ".:/root/builder"
    working_dir: /root
    command: /bin/bash -c "
      ./builder/build-frontend.sh &&
      ./builder/build-backend.sh &&
      ./builder/build-package.sh &&
      tail -f /dev/null
      "
    stop_signal: SIGKILL

  apk-builder:
    build:
      context: .
      dockerfile: alpine.Dockerfile
    image: "alpine-skeleton:3.11"
    container_name: skeleton-builder
    volumes:
      - ".:/root/builder"
    working_dir: /root
    command: /bin/ash -c "
      ./builder/build-frontend.sh &&
      ./builder/build-backend.sh .alpine &&
      ./builder/build-apk-package.sh &&
      tail -f /dev/null
      "
    stop_signal: SIGKILL

  deb-builder:
    build:
      context: .
      dockerfile: ubuntu.Dockerfile
    image: "ubuntu-skeleton:bionic"
    container_name: skeleton-builder
    volumes:
      - ".:/root/builder"
    working_dir: /root
    command: /bin/bash -c "
      ./builder/build-frontend.sh &&
      ./builder/build-backend.sh .ubuntu &&
      ./builder/build-package.sh ubuntu.deb &&
      tail -f /dev/null
      "
    stop_signal: SIGKILL
